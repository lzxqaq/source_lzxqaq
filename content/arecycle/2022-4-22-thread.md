---
title: "Qt 多线程和事件循环"
date: 2022-04-22T08:36:23+08:00
author: "Shaka"
slug: 
draft: true

---

# 多线程情况下，Qt中的信号和槽分别在什么线程中执行，如何控制

可以通过connect函数的第五个参数来控制信号槽执行时所在的线程。

1.自动连接（默认）：如果信号与槽，也就是发送者与接受者在同一线程，等同于直接连接；如果发送者与接受者处在不同线程，等同于队列连接。

2.直接连接：当信号发射的时候，槽函数直接调用。无论槽函数所属对象在哪个线程，槽函数总在发送者所在线程执行。即槽函数和信号发送者在同一个线程。

3.队列连接：当控制权回到接受者所在线程的时间循环时，槽函数被调用。槽函数在接受者所在的线程执行。即槽函数和信号接受者在同一线程。

# Qt 下多线程使用方式

第一种

1.继承 QThread 类
2.在子线程类重写run()函数，将处理操作写入该函数中
3.在主线程中创建子线程对象，启动子线程，调用start函数

第二种

1.继承QObject，然后再类中设置一个线程函数。
2.创建一个QTread子线程对象。
3.把自定义的线程类，加入到子线程
4.启动子线程，只是把线程开启了，并没有启动线程处理函数。
5.线程的启动，必须通过信号和槽的方式。

第三种 QRunnable的run

使用Qt线程池 需要继承 QRunnable，并重写run方法。

第四种 QtConcurrent的run

不用继承，直接写函数丢到子线程中执行，也是从线程池取。

# Qt 事件循环

1.Qt是事件驱动的，如何理解？

Qt 将系统产生的信号（软件中断）转换成Qt事件，并且将事件封装成类，所有的事件类都是由QEvent派生的，事件的产生和处理就是Qt程序的主轴，且伴随着整个程序的与运行周期。

2.Qt 事件处理的流程是怎样的？

事件通常是被分发到一个队列中（事件队列），当队列中有事件时就不停的将队列中的事件发送给QObject对象，当队列为空时就阻塞地等待事件，这个过程就就是事件循环。

QCoreAppication::exec() 开启事件循环，知道QCoreAppication::exit()被调用才终止，所以事件循环时伴随着Qt程序的整个运行周期。

另外一种同步处理情形时通过sendEvent()将事件发送出去，直接进入事件的传送和处理流程。

postEvent和sendEvent的关系就像Qt::QueuedConnection和Qt::DirectConnection的关系，只不过前两者是分发事件后两者是发送消息罢了，机制上postEvent和QueuedConnected是异步通信，而另外两种是同步通信。

